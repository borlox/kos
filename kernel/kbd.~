#include <ports.h>

#include "kbd.h"

#define KBD_DATA 0x60
#define KBD_STATUS 0x64

static char buffer[256];
static char *bufhead, *buftail;
static int incount;

static inline void sendcmd(byte cmd)
{
	while (inb(KBD_STATUS) & 0x6) != 0x4) {
		/* busy waiting )-: */
	}
	outb(KBD_DATA, cmd);
}

static void kbd_irq_handler(int irq, dword *esp)
{
	byte scancode;
	char keycode = 0;

	scancode = inb(KBD_DATA);
}

void init_kbd(void)
{
	/* clear any keys left in the buffer */
	while (inb(KBD_READ) & 0x1) {
		inb(KBD_DATA);
	}

	idt_set_irq_handler(1, kbd_irq_handler);

	sendcmd(0xED); /* clear leds */
	outb(KBD_DATA, 0);

	sendcmd(0xF3); /* fast repeat rate */
	outb(KBD_DATA, 0);

	sendcmd(0xF4); /* activate */
}
